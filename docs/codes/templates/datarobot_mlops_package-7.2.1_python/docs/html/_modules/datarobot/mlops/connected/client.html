

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>datarobot.mlops.connected.client &mdash; DataRobot MLOps Agent DEV documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../../',
              VERSION:'DEV',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> DataRobot MLOps Agent
          

          
          </a>

          
            
            
              <div class="version">
                DEV
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../create_deployment.html">Monitoring Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../agent.html">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mlops_lib.html">MLOps Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../spooler_configuration.html">Spooler Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../environment_vars.html">Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../release_notes.html">Release Notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">DataRobot MLOps Agent</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>datarobot.mlops.connected.client</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for datarobot.mlops.connected.client</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">six</span> <span class="kn">import</span> <span class="n">string_types</span>

<span class="kn">import</span> <span class="nn">cgi</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">aiohttp</span>

<span class="kn">from</span> <span class="nn">datarobot.mlops.common.config</span> <span class="kn">import</span> <span class="n">ConfigConstants</span><span class="p">,</span> <span class="n">get_config_default</span>
<span class="kn">from</span> <span class="nn">datarobot.mlops.common.exception</span> <span class="kn">import</span> <span class="n">DRConnectedException</span><span class="p">,</span> <span class="n">DRUnsupportedType</span>
<span class="kn">from</span> <span class="nn">datarobot.mlops.connected.enums</span> <span class="kn">import</span> <span class="n">DatasetSourceType</span><span class="p">,</span> <span class="n">HTTPStatus</span>
<span class="kn">from</span> <span class="nn">datarobot.mlops.connected.url_helper</span> <span class="kn">import</span> <span class="n">MMMEndpoint</span>
<span class="kn">from</span> <span class="nn">datarobot.mlops.constants</span> <span class="kn">import</span> <span class="n">Constants</span>
<span class="kn">from</span> <span class="nn">datarobot.mlops.common.enums</span> <span class="kn">import</span> <span class="n">DataFormat</span>
<span class="kn">from</span> <span class="nn">datarobot.mlops.metric</span> <span class="kn">import</span> <span class="n">GeneralStats</span><span class="p">,</span> <span class="n">DeploymentStats</span><span class="p">,</span> \
    <span class="n">PredictionsData</span><span class="p">,</span> <span class="n">PredictionsDataContainer</span><span class="p">,</span> <span class="n">DeploymentStatsContainer</span>
<span class="kn">from</span> <span class="nn">datarobot.mlops.common.prediction_util</span> <span class="kn">import</span> <span class="n">get_predictions</span>
<span class="kn">from</span> <span class="nn">datarobot.mlops.connected.url_helper</span> <span class="kn">import</span> <span class="n">URLBuilder</span>

<span class="kn">from</span> <span class="nn">datarobot.mlops.metric</span> <span class="kn">import</span> <span class="n">SerializationConstants</span>


<span class="k">class</span> <span class="nc">MMMLimits</span><span class="p">:</span>
    <span class="n">DATA_REPORTING_MAX_CHUNKS</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">DATA_REPORTING_MAX_LINES_PER_CHUNK</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">ACTUALS_REPORTING_MAX_LINES</span> <span class="o">=</span> <span class="mi">10000</span>


<div class="viewcode-block" id="MLOpsClient"><a class="viewcode-back" href="../../../../mlops_client.html#datarobot.mlops.connected.client.MLOpsClient">[docs]</a><span class="k">class</span> <span class="nc">MLOpsClient</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class provides helper methods to communicate with</span>
<span class="sd">    DataRobot MLOps.</span>
<span class="sd">    *Note*:These class methods can only be run from a node</span>
<span class="sd">    with connectivity to DataRobot MLOps.</span>

<span class="sd">    :param service_url: DataRobot MLOps URL.</span>
<span class="sd">    :type service_url: str</span>
<span class="sd">    :param api_key: DataRobot App user API key.</span>
<span class="sd">    :type api_key: str</span>
<span class="sd">    :returns: class instance</span>
<span class="sd">    :rtype: MLOpsClient</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">AUTHORIZATION_TOKEN_PREFIX</span> <span class="o">=</span> <span class="s2">&quot;Token &quot;</span>
    <span class="n">RESPONSE_PREDICTION_ENVIRONMENT_ID_KEY</span> <span class="o">=</span> <span class="s2">&quot;id&quot;</span>
    <span class="n">RESPONSE_DEPLOYMENT_ID_KEY</span> <span class="o">=</span> <span class="s2">&quot;id&quot;</span>
    <span class="n">RESPONSE_MODEL_PACKAGE_ID_KEY</span> <span class="o">=</span> <span class="s2">&quot;id&quot;</span>
    <span class="n">RESPONSE_MODEL_ID_KEY</span> <span class="o">=</span> <span class="s2">&quot;modelId&quot;</span>
    <span class="n">RESPONSE_CATALOG_ID_KEY</span> <span class="o">=</span> <span class="s2">&quot;catalogId&quot;</span>
    <span class="n">RESPONSE_STATUS_KEY</span> <span class="o">=</span> <span class="s2">&quot;status&quot;</span>
    <span class="n">RESPONSE_MODEL_KEY</span> <span class="o">=</span> <span class="s2">&quot;model&quot;</span>
    <span class="n">RESPONSE_MODEL_PACKAGE_KEY</span> <span class="o">=</span> <span class="s2">&quot;modelPackage&quot;</span>
    <span class="n">RESPONSE_DATA_INFO_KEY</span> <span class="o">=</span> <span class="s2">&quot;externalDataInfo&quot;</span>
    <span class="n">RESPONSE_TARGET_KEY</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span>
    <span class="n">RESPONSE_TARGET_TYPE_KEY</span> <span class="o">=</span> <span class="s2">&quot;type&quot;</span>
    <span class="n">RESPONSE_LOCATION_KEY</span> <span class="o">=</span> <span class="s2">&quot;Location&quot;</span>
    <span class="n">RESPONSE_FULL_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;versionString&quot;</span>
    <span class="n">RESPONSE_API_MAJOR_VERSION</span> <span class="o">=</span> <span class="s2">&quot;major&quot;</span>
    <span class="n">RESPONSE_API_MINOR_VERSION</span> <span class="o">=</span> <span class="s2">&quot;minor&quot;</span>

    <span class="n">ASYNC_STATUS_ACTIVE</span> <span class="o">=</span> <span class="s2">&quot;active&quot;</span>
    <span class="n">ASYNC_STATUS_ERROR</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span>
    <span class="n">ASYNC_STATUS_ABORT</span> <span class="o">=</span> <span class="s2">&quot;abort&quot;</span>
    <span class="n">ASYNC_STATUS_INITIALIZED</span> <span class="o">=</span> <span class="s2">&quot;initialized&quot;</span>
    <span class="n">ASYNC_STATUS_RUNNING</span> <span class="o">=</span> <span class="s2">&quot;running&quot;</span>
    <span class="n">ASYNC_WAIT_SLEEP_TIME</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c1"># match the target type strings in API payloads and responses</span>
    <span class="n">TARGET_TYPE_BINARY</span> <span class="o">=</span> <span class="s2">&quot;Binary&quot;</span>
    <span class="n">TARGET_TYPE_REGRESSION</span> <span class="o">=</span> <span class="s2">&quot;Regression&quot;</span>
    <span class="n">TARGET_TYPE_MULTICLASS</span> <span class="o">=</span> <span class="s2">&quot;Multiclass&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_url</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span> <span class="o">=</span> <span class="n">service_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_key</span> <span class="o">=</span> <span class="n">MLOpsClient</span><span class="o">.</span><span class="n">AUTHORIZATION_TOKEN_PREFIX</span> <span class="o">+</span> <span class="n">api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verify</span> <span class="o">=</span> <span class="n">verify</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_key</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_version</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_major_version</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_minor_version</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span> <span class="o">=</span> <span class="n">URLBuilder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_api_version</span><span class="p">()</span>

        <span class="n">major</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">minor</span> <span class="o">=</span> <span class="mi">18</span>
        <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;Tracking Agent can work with DataRobot API version &#39;</span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2">&#39; and above.&quot;</span> \
                <span class="s2">&quot;Current version: </span><span class="si">{}</span><span class="s2"> is old.&quot;</span> \
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_version</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_major_version</span> <span class="o">&lt;</span> <span class="n">major</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_major_version</span> <span class="o">==</span> <span class="n">major</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_minor_version</span> <span class="o">&lt;</span> <span class="n">minor</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verify</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: SSL certificates will not be verified.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_wait_for_async_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">async_location</span><span class="p">,</span> <span class="n">max_wait</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wait for successful resolution of the provided async_location.</span>

<span class="sd">        :param async_location: The URL we are polling for resolution.</span>
<span class="sd">        :type async_location: str</span>
<span class="sd">        :param max_wait: The number of seconds to wait before giving up.</span>
<span class="sd">        :type max_wait: int</span>
<span class="sd">        :returns: True on success.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        :returns: The URL of the now-finished resource.</span>
<span class="sd">        :rtype str</span>
<span class="sd">        :raises: DRConnectedException if status is error.</span>
<span class="sd">        :raises: RuntimeError if the resource did not resolve in time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">max_wait</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_url_request_response</span><span class="p">(</span><span class="n">async_location</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">SEE_OTHER</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_LOCATION_KEY</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2">; failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">async_location</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_STATUS_KEY</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">async_status</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_STATUS_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">async_status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">ASYNC_STATUS_INITIALIZED</span><span class="p">,</span>
                                    <span class="n">MLOpsClient</span><span class="o">.</span><span class="n">ASYNC_STATUS_RUNNING</span><span class="p">]:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">async_status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">ASYNC_STATUS_ACTIVE</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">async_status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">ASYNC_STATUS_ABORT</span><span class="p">,</span>
                                      <span class="n">MLOpsClient</span><span class="o">.</span><span class="n">ASYNC_STATUS_ERROR</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Task status &#39;</span><span class="si">{}</span><span class="s2">&#39; is not valid&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">async_status</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">ASYNC_WAIT_SLEEP_TIME</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Client timed out waiting for </span><span class="si">{}</span><span class="s2"> to resolve&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">async_location</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">update_api_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">MMMEndpoint</span><span class="o">.</span><span class="n">API_VERSION</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_api_version</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_FULL_API_VERSION</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_api_major_version</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_API_MAJOR_VERSION</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_api_minor_version</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_API_MINOR_VERSION</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2">  failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">delete_deployment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the deployment with the provided ID.</span>

<span class="sd">        :param deployment_id: ID of the deployment to delete.</span>
<span class="sd">        :type deployment_id: str</span>
<span class="sd">        :returns void</span>
<span class="sd">        :raises DRConnectedException: if the deployment does not exist, user does not have</span>
<span class="sd">        permission to delete, or the deployment is in use by an application</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">deployment</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>

            <span class="c1"># status code is:</span>
            <span class="c1"># NO_CONTENT when deployment is deleted</span>
            <span class="c1"># GONE when deployment was previously deleted</span>
            <span class="c1"># NOT_FOUND if deployment was already deleted or user has no permission to delete</span>
            <span class="c1"># 422 if an application is currently associated with the deployment</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">[</span><span class="n">HTTPStatus</span><span class="o">.</span><span class="n">NO_CONTENT</span><span class="p">]:</span>
                <span class="k">return</span>
            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed; deployment id &#39;</span><span class="si">{}</span><span class="s2">&#39; not found&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">IN_USE</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed; deployment id &#39;</span><span class="si">{}</span><span class="s2">&#39; in use&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed: unexpected status code: </span><span class="si">{}</span><span class="s2">; text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

<div class="viewcode-block" id="MLOpsClient.upload_dataset"><a class="viewcode-back" href="../../../../mlops_client.html#datarobot.mlops.connected.client.MLOpsClient.upload_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">upload_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_filepath</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload a dataset (from a CSV file) into DataRobot MLOps.</span>

<span class="sd">        :param dataset_filepath: path to a CSV dataset file.</span>
<span class="sd">        :type dataset_filepath: str</span>
<span class="sd">        :param timeout: time to wait for result (sec). Default: 180 sec.</span>
<span class="sd">        :type timeout: int</span>
<span class="sd">        :returns: dataset ID</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if dataset upload failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">upload_dataset</span><span class="p">()</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;dummy-catalog-id-dry-run&quot;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dataset_filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataset_file</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
                                         <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">dataset_filepath</span><span class="p">,</span> <span class="n">dataset_file</span><span class="p">)},</span>
                                         <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_async_completion</span><span class="p">(</span>
                        <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_LOCATION_KEY</span><span class="p">],</span> <span class="n">timeout</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_CATALOG_ID_KEY</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                        <span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> with filename </span><span class="si">{}</span><span class="s2"> failed text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">dataset_filepath</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">upload_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload a dataframe to MLOps.  Internally, a dataframe is serialized to CSV and then</span>
<span class="sd">        uploaded to AI Catalog.  Filename is used just as display name, no actual file is created</span>

<span class="sd">        :param df: input dataframe to upload</span>
<span class="sd">        :type df: pandas.Dataframe</span>
<span class="sd">        :param filename: Filename string used as display name in &quot;AI Catalog&quot;</span>
<span class="sd">        :type filename: str</span>
<span class="sd">        :param timeout: time to wait for result (sec). Default: 180 sec.</span>
<span class="sd">        :type timeout: int</span>
<span class="sd">        :returns: dataset ID</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if dataset upload failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">upload_dataset</span><span class="p">()</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;dummy-catalog-id-dry-run&quot;</span>

            <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
                <span class="n">file_meta</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file_meta</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">file_meta</span><span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                                     <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_async_completion</span><span class="p">(</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_LOCATION_KEY</span><span class="p">],</span> <span class="n">timeout</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_CATALOG_ID_KEY</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                    <span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> for dataframe failed text:[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_url_request_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="n">allow_redirects</span><span class="p">,</span>
                            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">api_version_smaller_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_major_version</span> <span class="o">&lt;</span> <span class="n">major</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_major_version</span> <span class="o">==</span> <span class="n">major</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_minor_version</span> <span class="o">&lt;</span> <span class="n">minor</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">associate_deployment_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">,</span> <span class="n">data_source_type</span><span class="p">,</span>
                                     <span class="n">timeout</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Associate a dataset with a deployment in DataRobot MLOps.</span>

<span class="sd">        :param deployment_id: deployment ID.</span>
<span class="sd">        :type deployment_id: str</span>
<span class="sd">        :param dataset_id: dataset ID.</span>
<span class="sd">        :type dataset_id: str</span>
<span class="sd">        :param data_source_type: dataset type.</span>
<span class="sd">        :type data_source_type: DatasetSourceType</span>
<span class="sd">        :param timeout: time to wait for result (sec). Default: 180 sec.</span>
<span class="sd">        :type timeout: int</span>
<span class="sd">        :returns: True if association succeeded.</span>
<span class="sd">        :raises DRUnsupportedType: if data source type is not supported.</span>
<span class="sd">        :raises DRConnectedException: if association failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_source_type</span><span class="p">,</span> <span class="n">DatasetSourceType</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DRUnsupportedType</span><span class="p">(</span><span class="s2">&quot;data_source_type must be of type &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">DatasetSourceType</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data_source_type</span> <span class="o">==</span> <span class="n">DatasetSourceType</span><span class="o">.</span><span class="n">TRAINING</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Associating Training dataset with deployment is not allowed&quot;</span>
                                       <span class="s2">&quot;, assoicate training data with model package&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data_source_type</span> <span class="o">!=</span> <span class="n">DatasetSourceType</span><span class="o">.</span><span class="n">SCORING</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Invalid data source type &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_source_type</span><span class="p">))</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;datasetId&quot;</span><span class="p">:</span> <span class="n">dataset_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">associate_deployment_dataset</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">})</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_version_smaller_than</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">23</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_async_completion</span><span class="p">(</span>
                        <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_LOCATION_KEY</span><span class="p">],</span> <span class="n">timeout</span>
                    <span class="p">)</span>
                <span class="c1"># API responds with HTTP 202, but no longer provides a location header</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> with payload </span><span class="si">{}</span><span class="s2"> failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_deployment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get deployment.</span>

<span class="sd">        :param deployment_id: deployment ID.</span>
<span class="sd">        :type deployment_id: str</span>
<span class="sd">        :returns: json of deployment info</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if request fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">deployment</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_url_request_response</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">list_deployments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">list_deployments</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_list_call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

<div class="viewcode-block" id="MLOpsClient.get_model_id"><a class="viewcode-back" href="../../../../mlops_client.html#datarobot.mlops.connected.client.MLOpsClient.get_model_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_model_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get model ID by deployment ID.</span>

<span class="sd">        :param deployment_id: deployment ID.</span>
<span class="sd">        :type deployment_id: str</span>
<span class="sd">        :returns: model ID</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if request fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deployment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_deployment</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
        <span class="n">model_package_id</span> <span class="o">=</span> <span class="n">deployment</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_MODEL_PACKAGE_KEY</span><span class="p">][</span>
            <span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_MODEL_PACKAGE_ID_KEY</span><span class="p">]</span>
        <span class="n">model_package</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_package</span><span class="p">(</span><span class="n">model_package_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model_package</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_MODEL_ID_KEY</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">get_deployment_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the type of deployment &#39;Binary&#39; or &#39;Regression&#39;</span>
<span class="sd">        :param deployment_id:</span>
<span class="sd">        :type deployment_id: str</span>
<span class="sd">        :return: Type of Deployment &#39;Binary&#39; or &#39;Regression&#39;</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if request fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deployment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_deployment</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>

        <span class="n">model_package_id</span> <span class="o">=</span> <span class="n">deployment</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_MODEL_PACKAGE_KEY</span><span class="p">][</span>
            <span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_MODEL_PACKAGE_ID_KEY</span><span class="p">]</span>
        <span class="n">model_package</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_package</span><span class="p">(</span><span class="n">model_package_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">model_package</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_TARGET_KEY</span><span class="p">][</span>
            <span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_TARGET_TYPE_KEY</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get dataset by ID.</span>

<span class="sd">        :param dataset_id: dataset ID.</span>
<span class="sd">        :type dataset_id: str</span>
<span class="sd">        :returns: dataset metadata</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if request fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_url_request_response</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">list_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">list_datasets</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_list_call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">soft_delete_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Soft delete (mark as deleted) the dataset with the provided ID.</span>

<span class="sd">        :param dataset_id: ID of the dataset to delete.</span>
<span class="sd">        :type dataset_id: str</span>
<span class="sd">        :returns True, if dataset has been successfully deleted during this call or before.</span>
<span class="sd">        :rtype str</span>
<span class="sd">        :raises DRConnectedException: if dataset with provided ID has never existed in the system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">soft_delete_dataset</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>

            <span class="c1"># status code is:</span>
            <span class="c1"># NO_CONTENT when dataset was deleted</span>
            <span class="c1"># GONE when dataset was previously deleted</span>
            <span class="c1"># NOT_FOUND when dataset with provided DIId has never existed</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">[</span><span class="n">HTTPStatus</span><span class="o">.</span><span class="n">NO_CONTENT</span><span class="p">,</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">GONE</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed; dataset id &#39;</span><span class="si">{}</span><span class="s2">&#39; has never existed&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed: unexpected status code: </span><span class="si">{}</span><span class="s2">; text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

<div class="viewcode-block" id="MLOpsClient.set_scoring_dataset"><a class="viewcode-back" href="../../../../mlops_client.html#datarobot.mlops.connected.client.MLOpsClient.set_scoring_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">set_scoring_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">,</span> <span class="n">dataset_filepath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload scoring dataset and</span>
<span class="sd">        associate it with a deployment in DataRobot MLOps.</span>

<span class="sd">        :param deployment_id: deployment ID.</span>
<span class="sd">        :type deployment_id: str</span>
<span class="sd">        :param dataset_filepath: path to a CSV dataset file.</span>
<span class="sd">        :type dataset_filepath: str</span>
<span class="sd">        :returns: dataset ID</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataset_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_dataset</span><span class="p">(</span><span class="n">dataset_filepath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">associate_deployment_dataset</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">,</span> <span class="n">DatasetSourceType</span><span class="o">.</span><span class="n">SCORING</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataset_id</span></div>

<div class="viewcode-block" id="MLOpsClient.submit_actuals"><a class="viewcode-back" href="../../../../mlops_client.html#datarobot.mlops.connected.client.MLOpsClient.submit_actuals">[docs]</a>    <span class="k">def</span> <span class="nf">submit_actuals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">,</span> <span class="n">actuals</span><span class="p">,</span>
                       <span class="n">wait_for_result</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">180</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param deployment_id: ID of the deployment for which the actuals are being submitted</span>
<span class="sd">        :param actuals: List of actuals with schema:</span>
<span class="sd">                        Regression: {&quot;actualValue&quot;: 23, &quot;wasActedOn&quot;: False / True,</span>
<span class="sd">                        &quot;timestamp&quot;: RFC3339 timestamp, &quot;associationId&quot;: &quot;x_23423_23423&quot;}</span>
<span class="sd">                        Binary: {&quot;actualValue&quot;: &quot;&lt;className&gt;&quot;, &quot;wasActedOn&quot;: False / True,</span>
<span class="sd">                        &quot;timestamp&quot;: RFC3339 timestamp, &quot;associationId&quot;: &quot;x_23423_23423&quot;}</span>
<span class="sd">        :param wait_for_result: if True, wait for operation to finish. If False, return immediately.</span>
<span class="sd">        :type wait_for_result: bool</span>
<span class="sd">        :param timeout: if wait_for_result is True, how long to wait for async completion</span>
<span class="sd">        :type timeout: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">actuals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Empty actuals list to post&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">actual</span> <span class="ow">in</span> <span class="n">actuals</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_VALUE_KEY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">actual</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; missing in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_VALUE_KEY</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actual</span><span class="p">[</span><span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_VALUE_KEY</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actual</span><span class="p">[</span><span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_VALUE_KEY</span><span class="p">],</span> <span class="n">string_types</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actual</span><span class="p">[</span><span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_VALUE_KEY</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="n">DRUnsupportedType</span><span class="p">(</span>
                    <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; must be either string, int or float, &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_VALUE_KEY</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_ASSOCIATION_ID_KEY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">actual</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; missing in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_ASSOCIATION_ID_KEY</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_WAS_ACTED_ON_KEY</span> <span class="ow">in</span> <span class="n">actual</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actual</span><span class="p">[</span><span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_WAS_ACTED_ON_KEY</span><span class="p">],</span> <span class="nb">bool</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="n">DRUnsupportedType</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; should be bool, &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_WAS_ACTED_ON_KEY</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span>
                <span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">get_actuals</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">})</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">actuals</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">ACCEPTED</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Failed to post actuals: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">wait_for_result</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_async_completion</span><span class="p">(</span>
                <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_LOCATION_KEY</span><span class="p">],</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_validate_col_exists</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">col_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Data does not include </span><span class="si">{}</span><span class="s2"> column&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col_name</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_correct_actual_value</span><span class="p">(</span><span class="n">deployment_type</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">deployment_type</span> <span class="o">==</span> <span class="s2">&quot;Regression&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_correct_flag_value</span><span class="p">(</span><span class="n">value_str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value_str</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">submit_actuals_from_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">deployment_id</span><span class="p">,</span>
                                      <span class="n">dataframe</span><span class="p">,</span>
                                      <span class="n">assoc_id_col</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_ASSOCIATION_ID_KEY</span><span class="p">,</span>
                                      <span class="n">actual_value_col</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_VALUE_KEY</span><span class="p">,</span>
                                      <span class="n">was_act_on_col</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_WAS_ACTED_ON_KEY</span><span class="p">,</span>
                                      <span class="n">timestamp_col</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_TIMESTAMP_KEY</span><span class="p">,</span>
                                      <span class="n">progress_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                      <span class="n">wait_for_result</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                      <span class="n">timeout</span><span class="o">=</span><span class="mi">120</span>
                                      <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submit actulas to MLOps App from the given dataframe.</span>
<span class="sd">        This call will specific columns of the dataframe to extract the association ids,</span>
<span class="sd">        actual values of predictions and other information. The data will be submitted to the</span>
<span class="sd">        MLOps app chunk by chunk, where the maximal chunk size is 10K lines.</span>

<span class="sd">        :param deployment_id: ID of deployment to report actual on</span>
<span class="sd">        :type deployment_id: str</span>
<span class="sd">        :param dataframe: Pandas dataframe containing all the data</span>
<span class="sd">        :type dataframe: dataframe</span>
<span class="sd">        :param assoc_id_col: Name of column containing the unique id for each prediction</span>
<span class="sd">        :type assoc_id_col: str</span>
<span class="sd">        :param actual_value_col: Name of column containing the actual value</span>
<span class="sd">        :type actual_value_col: str</span>
<span class="sd">        :param was_act_on_col: Name of column which indicate if there was an action taken on this</span>
<span class="sd">                               prediction</span>
<span class="sd">        :type was_act_on_col: str</span>
<span class="sd">        :param timestamp_col: Name of column containing a timestamp for the action</span>
<span class="sd">        :type timestamp_col: str</span>
<span class="sd">        :param progress_callback: A function to call after each chunk is sent to the MLOps App.</span>
<span class="sd">         Function signature is:</span>
<span class="sd">           progress_callback(total_number_of_actuals,</span>
<span class="sd">                             actuals_sent_so_far,</span>
<span class="sd">                             time_sending_last_chunk_in_seconds)</span>

<span class="sd">        :returns: The status of the last request to submit actuals. see the submit_actuals method</span>
<span class="sd">        :raises DRConnectedException: If there was an error connecting to the MLOps app.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Sanity check that we have all needed columns in our data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_col_exists</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">actual_value_col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_col_exists</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">assoc_id_col</span><span class="p">)</span>

        <span class="c1"># Renaming the columns in case the columns needed are not in the expected name</span>
        <span class="n">cols_to_rename</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">assoc_id_col</span> <span class="o">!=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_ASSOCIATION_ID_KEY</span><span class="p">:</span>
            <span class="n">cols_to_rename</span><span class="p">[</span><span class="n">assoc_id_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_ASSOCIATION_ID_KEY</span>
        <span class="k">if</span> <span class="n">actual_value_col</span> <span class="o">!=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_VALUE_KEY</span><span class="p">:</span>
            <span class="n">cols_to_rename</span><span class="p">[</span><span class="n">actual_value_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_VALUE_KEY</span>
        <span class="k">if</span> <span class="n">was_act_on_col</span> <span class="o">!=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_WAS_ACTED_ON_KEY</span><span class="p">:</span>
            <span class="n">cols_to_rename</span><span class="p">[</span><span class="n">was_act_on_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_WAS_ACTED_ON_KEY</span>
        <span class="k">if</span> <span class="n">timestamp_col</span> <span class="o">!=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_TIMESTAMP_KEY</span><span class="p">:</span>
            <span class="n">cols_to_rename</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_TIMESTAMP_KEY</span>
        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols_to_rename</span><span class="p">)</span>

        <span class="c1"># Taking only the columns we need for the actuals reporting</span>
        <span class="n">cols_to_take</span> <span class="o">=</span> <span class="p">[</span><span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_VALUE_KEY</span><span class="p">,</span>
                        <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_ASSOCIATION_ID_KEY</span><span class="p">,</span>
                        <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_TIMESTAMP_KEY</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_WAS_ACTED_ON_KEY</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">cols_to_take</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_WAS_ACTED_ON_KEY</span><span class="p">)</span>

        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">cols_to_take</span><span class="p">]</span>

        <span class="c1"># Iterating over the rows of the dataframe and building the actuals list of dictionaries</span>
        <span class="n">deployment_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_deployment_type</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
        <span class="n">actuals</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">request_ret_val</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">total_number_of_actuals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">requests_sent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">actual</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_WAS_ACTED_ON_KEY</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_correct_flag_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">Constants</span><span class="o">.</span><span class="n">ACTUALS_VALUE_KEY</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_correct_actual_value</span><span class="p">(</span><span class="n">deployment_type</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">actual</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">actuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">actuals</span><span class="p">)</span> <span class="o">==</span> <span class="n">MMMLimits</span><span class="o">.</span><span class="n">ACTUALS_REPORTING_MAX_LINES</span><span class="p">:</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">request_ret_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_actuals</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">,</span>
                                                      <span class="n">actuals</span><span class="p">,</span>
                                                      <span class="n">wait_for_result</span><span class="o">=</span><span class="n">wait_for_result</span><span class="p">,</span>
                                                      <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
                <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">requests_sent</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">progress_callback</span><span class="p">:</span>
                    <span class="n">progress_callback</span><span class="p">(</span><span class="n">total_number_of_actuals</span><span class="p">,</span>
                                      <span class="n">requests_sent</span> <span class="o">*</span> <span class="n">MMMLimits</span><span class="o">.</span><span class="n">ACTUALS_REPORTING_MAX_LINES</span><span class="p">,</span>
                                      <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
                <span class="n">actuals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">actuals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">request_ret_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_actuals</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">,</span>
                                                  <span class="n">actuals</span><span class="p">,</span>
                                                  <span class="n">wait_for_result</span><span class="o">=</span><span class="n">wait_for_result</span><span class="p">,</span>
                                                  <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">progress_callback</span><span class="p">:</span>
                <span class="n">progress_callback</span><span class="p">(</span><span class="n">total_number_of_actuals</span><span class="p">,</span> <span class="n">total_number_of_actuals</span><span class="p">,</span>
                                  <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">request_ret_val</span>

<div class="viewcode-block" id="MLOpsClient.create_model_package"><a class="viewcode-back" href="../../../../mlops_client.html#datarobot.mlops.connected.client.MLOpsClient.create_model_package">[docs]</a>    <span class="k">def</span> <span class="nf">create_model_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an external model package in DataRobot MLOps from JSON configuration.</span>

<span class="sd">        :param model_info: a JSON object of model parameters</span>
<span class="sd">        :type model_info: dict</span>
<span class="sd">        :returns: model package ID of newly created model</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if model package creation failed.</span>

<span class="sd">        Example JSON for a regression model:</span>

<span class="sd">        .. sourcecode:: json</span>

<span class="sd">            {</span>
<span class="sd">              &quot;name&quot;: &quot;Lending club regression&quot;,</span>
<span class="sd">              &quot;modelDescription&quot;: {</span>
<span class="sd">                &quot;description&quot;: &quot;Regression on lending club dataset&quot;</span>
<span class="sd">              }</span>
<span class="sd">              &quot;target&quot;: {</span>
<span class="sd">                &quot;type&quot;: &quot;Regression&quot;,</span>
<span class="sd">                &quot;name&quot;: &quot;loan_amnt</span>
<span class="sd">              }</span>
<span class="sd">            }</span>


<span class="sd">        Example JSON for a binary classification model:</span>

<span class="sd">        .. sourcecode:: json</span>

<span class="sd">            {</span>
<span class="sd">              &quot;name&quot;: &quot;Surgical Model&quot;,</span>
<span class="sd">              &quot;modelDescription&quot;: {</span>
<span class="sd">                &quot;description&quot;: &quot;Binary classification on surgical dataset&quot;,</span>
<span class="sd">                &quot;location&quot;: &quot;/tmp/myModel&quot;</span>
<span class="sd">              },</span>
<span class="sd">              &quot;target&quot;: {</span>
<span class="sd">                 &quot;type&quot;: &quot;Binary&quot;,</span>
<span class="sd">                 &quot;name&quot;: &quot;complication&quot;,</span>
<span class="sd">                 &quot;classNames&quot;: [&quot;Yes&quot;,&quot;No&quot;],  # minority/positive class should be listed first</span>
<span class="sd">                 &quot;predictionThreshold&quot;: 0.5</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        Example JSON for a multiclass classification model:</span>

<span class="sd">        .. sourcecode:: json</span>

<span class="sd">            {</span>
<span class="sd">                &quot;name&quot;: &quot;Iris classifier&quot;,</span>
<span class="sd">                &quot;modelDescription&quot;: {</span>
<span class="sd">                    &quot;description&quot;: &quot;Classification on iris dataset&quot;,</span>
<span class="sd">                    &quot;location&quot;: &quot;/tmp/myModel&quot;</span>
<span class="sd">                },</span>
<span class="sd">                &quot;target&quot;: {</span>
<span class="sd">                    &quot;type&quot;: &quot;Multiclass&quot;,</span>
<span class="sd">                    &quot;name&quot;: &quot;Species&quot;,</span>
<span class="sd">                    &quot;classNames&quot;: [</span>
<span class="sd">                        &quot;Iris-versicolor&quot;,</span>
<span class="sd">                        &quot;Iris-virginica&quot;,</span>
<span class="sd">                        &quot;Iris-setosa&quot;</span>
<span class="sd">                    ]</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">create_model_package</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">target_type</span> <span class="o">=</span> <span class="n">model_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RESPONSE_TARGET_KEY</span><span class="p">][</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">RESPONSE_TARGET_TYPE_KEY</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;create_model_package(): target type is missing&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TARGET_TYPE_MULTICLASS</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">get_config_default</span><span class="p">(</span><span class="n">ConfigConstants</span><span class="o">.</span><span class="n">IS_MULTICLASS_ENABLED</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;create_model_package(): called with &quot;</span>
                                               <span class="s2">&quot;multiclass target, but multiclass is not enabled&quot;</span><span class="p">)</span>

            <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">)</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">})</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">model_info</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                                     <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_MODEL_PACKAGE_ID_KEY</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> with payload </span><span class="si">{}</span><span class="s2"> failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">model_info</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="MLOpsClient.get_model_package"><a class="viewcode-back" href="../../../../mlops_client.html#datarobot.mlops.connected.client.MLOpsClient.get_model_package">[docs]</a>    <span class="k">def</span> <span class="nf">get_model_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_package_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get information about a model package from DataRobot MLOps.</span>

<span class="sd">        :param model_package_id: ID of the model package</span>
<span class="sd">        :type model_package_id: str</span>
<span class="sd">        :returns: JSON containing the model package metadata</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if model package retrieval failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">get_model_package</span><span class="p">(</span><span class="n">model_package_id</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_url_request_response</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="n">json_response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">json_response</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">list_model_packages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">list_model_packages</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_list_call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">archive_model_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_package_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a model package from DataRobot MLOps.</span>

<span class="sd">        :param model_package_id: ID of the model package</span>
<span class="sd">        :type model_package_id: str</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if the model package doesn&#39;t exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">archive_model_package</span><span class="p">(</span><span class="n">model_package_id</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>

            <span class="c1"># status code is:</span>
            <span class="c1"># NO_CONTENT when model package was deleted</span>
            <span class="c1"># GONE when model package was previously deleted</span>
            <span class="c1"># NOT_FOUND when model package with provided id has never existed</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">[</span><span class="n">HTTPStatus</span><span class="o">.</span><span class="n">NO_CONTENT</span><span class="p">,</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">GONE</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed; model package id &#39;</span><span class="si">{}</span><span class="s2">&#39; has never existed&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">model_package_id</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed: unexpected status code: </span><span class="si">{}</span><span class="s2">; text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

<div class="viewcode-block" id="MLOpsClient.deploy_model_package"><a class="viewcode-back" href="../../../../mlops_client.html#datarobot.mlops.connected.client.MLOpsClient.deploy_model_package">[docs]</a>    <span class="k">def</span> <span class="nf">deploy_model_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_package_id</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                             <span class="n">wait_for_result</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">prediction_environment_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new deployment for the model package.</span>

<span class="sd">        :param model_package_id: ID of the model package</span>
<span class="sd">        :type model_package_id: str</span>
<span class="sd">        :param label: label for this deployment</span>
<span class="sd">        :type label: str</span>
<span class="sd">        :param description: description for this deployment</span>
<span class="sd">        :type description: str</span>
<span class="sd">        :param wait_for_result: if True, wait for operation to finish. If False, return immediately.</span>
<span class="sd">        :type wait_for_result: bool</span>
<span class="sd">        :param timeout: if wait_for_result is True, how long to wait for async completion</span>
<span class="sd">        :type timeout: int</span>
<span class="sd">        :param prediction_environment_id: ID of prediction environment to deploy to.</span>
<span class="sd">        :type prediction_environment_id: str</span>
<span class="sd">        :return: deployment ID of the new deployment</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if deployment fails</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">deployment_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;modelPackageId&quot;</span><span class="p">:</span> <span class="n">model_package_id</span><span class="p">,</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">prediction_environment_id</span><span class="p">:</span>
            <span class="n">deployment_info</span><span class="p">[</span><span class="s2">&quot;predictionEnvironmentId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prediction_environment_id</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">deploy_model_package</span><span class="p">()</span>

            <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">)</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">})</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">deployment_info</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                                     <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="n">deployment_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_DEPLOYMENT_ID_KEY</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">wait_for_result</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_async_completion</span><span class="p">(</span>
                        <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_LOCATION_KEY</span><span class="p">],</span> <span class="n">timeout</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">deployment_id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> with payload </span><span class="si">{}</span><span class="s2"> failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">deployment_info</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="MLOpsClient.replace_model_package"><a class="viewcode-back" href="../../../../mlops_client.html#datarobot.mlops.connected.client.MLOpsClient.replace_model_package">[docs]</a>    <span class="k">def</span> <span class="nf">replace_model_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">,</span> <span class="n">model_package_id</span><span class="p">,</span> <span class="n">reason</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">180</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new deployment for the model package.</span>

<span class="sd">        :param deployment_id: ID of the deployment</span>
<span class="sd">        :type model_package_id: str</span>
<span class="sd">        :param model_package_id: ID of the model package</span>
<span class="sd">        :type model_package_id: str</span>
<span class="sd">        :param reason: reason for replacement. One of &quot;ACCURACY&quot;, &quot;DATA_DRIFT&quot;,</span>
<span class="sd">                       &quot;ERRORS&quot;, &quot;SCHEDULED_REFRESH&quot;, &quot;SCORING_SPEED&quot;, or &quot;OTHER&quot;</span>
<span class="sd">        :param timeout: time to wait for result (sec). Default: 180 sec.</span>
<span class="sd">        :type timeout: int</span>
<span class="sd">        :return: void</span>
<span class="sd">        :raises DRConnectedException: if model replacement fails</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">replacement_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;modelPackageId&quot;</span><span class="p">:</span> <span class="n">model_package_id</span><span class="p">,</span>
            <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">reason</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">replace_model_package</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">)</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">})</span>

            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">replacement_info</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                                      <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_async_completion</span><span class="p">(</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_LOCATION_KEY</span><span class="p">],</span> <span class="n">timeout</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                    <span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> with deployment_id </span><span class="si">{}</span><span class="s2"> and model_package_id </span><span class="si">{}</span><span class="s2"> failed text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">,</span> <span class="n">model_package_id</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">update_deployment_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">,</span> <span class="n">target_drift</span><span class="p">,</span> <span class="n">feature_drift</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">180</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update deployment settings.</span>

<span class="sd">        :param deployment_id: deployment ID.</span>
<span class="sd">        :type deployment_id: str</span>
<span class="sd">        :param target_drift: whether to enable target drift</span>
<span class="sd">        :type target_drift: bool</span>
<span class="sd">        :param feature_drift: whether to enable feature drift</span>
<span class="sd">        :type feature_drift: bool</span>
<span class="sd">        :param timeout: time to wait for result (sec). Default: 180 sec.</span>
<span class="sd">        :type timeout: int</span>
<span class="sd">        :returns: void</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">target_drift_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="n">target_drift</span><span class="p">}</span>
        <span class="n">feature_drift_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="n">feature_drift</span><span class="p">}</span>

        <span class="n">settings_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;targetDrift&quot;</span><span class="p">:</span> <span class="n">target_drift_json</span><span class="p">,</span>
            <span class="s2">&quot;featureDrift&quot;</span><span class="p">:</span> <span class="n">feature_drift_json</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">deployment_settings</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">)</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">})</span>

            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">settings_info</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                                      <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_async_completion</span><span class="p">(</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_LOCATION_KEY</span><span class="p">],</span> <span class="n">timeout</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                    <span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> with deployment_id </span><span class="si">{}</span><span class="s2"> and deployment_settings </span><span class="si">{}</span><span class="s2"> failed text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">,</span> <span class="n">settings_info</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_deployment_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get information about a deployment from DataRobot MLOps.</span>

<span class="sd">        :param deployment_id: ID of the deployment</span>
<span class="sd">        :type deployment_id: str</span>
<span class="sd">        :returns: JSON containing the deployment settings metadata</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if model package retrieval failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">deployment_settings</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_url_request_response</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="n">json_response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">json_response</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">create_prediction_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pe_info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an external prediction environment in DataRobot MLOps from JSON configuration.</span>

<span class="sd">        :param pe_info: a JSON object of prediction environment parameters</span>
<span class="sd">        :type pe_info: dict</span>
<span class="sd">        :returns: prediction environment ID of newly created prediction environment</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if creation failed.</span>

<span class="sd">        Example JSON:</span>

<span class="sd">        .. sourcecode:: json</span>

<span class="sd">            {</span>
<span class="sd">              &quot;name&quot;: &quot;Prediction Environment Name&quot;,</span>
<span class="sd">              &quot;description&quot;: &quot;Environment used for developing new models&quot;,</span>
<span class="sd">              &quot;platform&quot;: &quot;Other&quot;,</span>
<span class="sd">              &quot;supportedModelFormats&quot;: [&quot;external&quot;]</span>
<span class="sd">            }</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">missing_keys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;platform&quot;</span><span class="p">,</span> <span class="s2">&quot;supportedModelFormats&quot;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="n">pe_info</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">missing_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                    <span class="s2">&quot;create_prediction_environment(): payload is missing </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">missing_keys</span><span class="p">))</span>

            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">create_prediction_environment</span><span class="p">()</span>

            <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">)</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">})</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">pe_info</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                                     <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_PREDICTION_ENVIRONMENT_ID_KEY</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> with payload </span><span class="si">{}</span><span class="s2"> failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">pe_info</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_prediction_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction_environment_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get information about a prediction environment from DataRobot MLOps.</span>

<span class="sd">        :param prediction_environment_id: ID of the prediction environment</span>
<span class="sd">        :type prediction_environment_id: str</span>
<span class="sd">        :returns: JSON containing the prediction environment metadata</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if prediction environment retrieval failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">get_prediction_environment</span><span class="p">(</span><span class="n">prediction_environment_id</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_url_request_response</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="n">json_response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">json_response</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_make_list_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_url_request_response</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">list_prediction_environments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">list_prediction_environments</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_list_call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_prediction_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction_environment_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the prediction environment with the provided ID.</span>

<span class="sd">        :param prediction_environment_id: ID of the prediction environment to delete.</span>
<span class="sd">        :type prediction_environment_id: str</span>
<span class="sd">        :returns void</span>
<span class="sd">        :raises DRConnectedException: if the prediction environment does not exist,</span>
<span class="sd">        user does not have permission to delete, or the prediction environment is</span>
<span class="sd">        in use by a deployment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">get_prediction_environment</span><span class="p">(</span><span class="n">prediction_environment_id</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>

            <span class="c1"># status code is:</span>
            <span class="c1"># NO_CONTENT when prediction environment is deleted</span>
            <span class="c1"># GONE if it was previously deleted</span>
            <span class="c1"># NOT_FOUND if PE was already deleted or user has no permission to delete</span>
            <span class="c1"># 422 if a deployment is currently associated with the PE</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">[</span><span class="n">HTTPStatus</span><span class="o">.</span><span class="n">NO_CONTENT</span><span class="p">]:</span>
                <span class="k">return</span>
            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                    <span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed; prediction environment id &#39;</span><span class="si">{}</span><span class="s2">&#39; not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">url</span><span class="p">,</span> <span class="n">prediction_environment_id</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">IN_USE</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed; prediction environment id &#39;</span><span class="si">{}</span><span class="s2">&#39; in use&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">prediction_environment_id</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed: unexpected status code: </span><span class="si">{}</span><span class="s2">; text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">payload_report_deployment_stats</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">model_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">num_predictions</span><span class="p">,</span> <span class="n">execution_time_ms</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">deployment_stats</span> <span class="o">=</span> <span class="n">DeploymentStats</span><span class="p">(</span><span class="n">num_predictions</span><span class="p">,</span> <span class="n">execution_time_ms</span><span class="p">)</span>
        <span class="n">deployment_stats_container</span> <span class="o">=</span> <span class="n">DeploymentStatsContainer</span><span class="p">(</span>
            <span class="n">GeneralStats</span><span class="p">(</span><span class="n">model_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">),</span> <span class="n">deployment_stats</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">deployment_stats_container</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">DataFormat</span><span class="o">.</span><span class="n">JSON</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">data</span><span class="p">]}</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">report_deployment_stats</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">deployment_id</span><span class="p">,</span>
            <span class="n">model_id</span><span class="p">,</span>
            <span class="n">num_predictions</span><span class="p">,</span>
            <span class="n">execution_time_ms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">report_deployment_stats</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">})</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">payload_report_deployment_stats</span><span class="p">(</span>
            <span class="n">model_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">num_predictions</span><span class="p">,</span> <span class="n">execution_time_ms</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;ok&quot;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">verify_ssl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">ACCEPTED</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                        <span class="s2">&quot;Failed to post deployment stats: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                    <span class="n">json_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">json_response</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                               <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">payload_report_prediction_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">model_id</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">association_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">assoc_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">predictions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">class_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds the payload to report to MLOps.</span>

<span class="sd">        Association ids can be passed using &#39;association_ids&#39; parameter or as part of &#39;data&#39;</span>
<span class="sd">        dataframe and passing column name in &#39;assoc_id&#39;.  If both are specified,</span>
<span class="sd">        &#39;association_ids&#39; is used.</span>

<span class="sd">        Similarly, predictions can be passed using &#39;predictions&#39; parameter or as part of &#39;data&#39;</span>
<span class="sd">        dataframe and passing column name in &#39;target_col&#39;.  If both are specified,</span>
<span class="sd">        &#39;predictions&#39; is used</span>

<span class="sd">        :param model_id:</span>
<span class="sd">        :param data:</span>
<span class="sd">        :param association_ids:</span>
<span class="sd">        :param assoc_id:</span>
<span class="sd">        :param predictions:</span>
<span class="sd">        :param target_col:</span>
<span class="sd">        :param class_names:</span>
<span class="sd">        :param timestamp:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">get_predictions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">class_names</span><span class="p">)</span>

        <span class="c1"># For 6.0 we should not drop the column</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_version</span> <span class="o">==</span> <span class="s2">&quot;2.20&quot;</span><span class="p">:</span>
            <span class="n">feature_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">target_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">target_col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">feature_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">target_col</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">feature_data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="n">assoc_id_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">association_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">assoc_id_list</span> <span class="o">=</span> <span class="n">association_ids</span>
        <span class="k">elif</span> <span class="n">assoc_id</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">assoc_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">feature_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error assoc_id column: </span><span class="si">{}</span><span class="s2"> is not present is dataframe&quot;</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">assoc_id</span><span class="p">))</span>
            <span class="n">assoc_id_list</span> <span class="o">=</span> <span class="n">feature_data</span><span class="p">[</span><span class="n">assoc_id</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">assoc_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">assoc_id</span> <span class="ow">in</span> <span class="n">feature_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">feature_data</span> <span class="o">=</span> <span class="n">feature_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">assoc_id</span><span class="p">)</span>

        <span class="n">nr_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">nr_chunks</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nr_lines</span> <span class="o">/</span> <span class="n">MMMLimits</span><span class="o">.</span><span class="n">DATA_REPORTING_MAX_LINES_PER_CHUNK</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nr_chunks</span> <span class="o">&gt;</span> <span class="n">MMMLimits</span><span class="o">.</span><span class="n">DATA_REPORTING_MAX_CHUNKS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The dataset provided for data reporting is too big. &quot;</span>
                            <span class="s2">&quot;Currently supporting up to </span><span class="si">{}</span><span class="s2"> lines&quot;</span>
                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MMMLimits</span><span class="o">.</span><span class="n">DATA_REPORTING_MAX_LINES_PER_CHUNK</span> <span class="o">*</span>
                                    <span class="n">MMMLimits</span><span class="o">.</span><span class="n">DATA_REPORTING_MAX_CHUNKS</span><span class="p">))</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">chunk_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nr_chunks</span><span class="p">):</span>
            <span class="n">from_line</span> <span class="o">=</span> <span class="n">chunk_idx</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">to_line</span> <span class="o">=</span> <span class="p">(</span><span class="n">chunk_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="k">if</span> <span class="n">to_line</span> <span class="o">&gt;</span> <span class="n">nr_lines</span><span class="p">:</span>
                <span class="n">to_line</span> <span class="o">=</span> <span class="n">nr_lines</span>

            <span class="n">assoc_id_list_section</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">assoc_id_list</span><span class="p">:</span>
                <span class="n">assoc_id_list_section</span> <span class="o">=</span> <span class="n">assoc_id_list</span><span class="p">[</span><span class="n">from_line</span><span class="p">:</span><span class="n">to_line</span><span class="p">]</span>
            <span class="n">features_df</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">features_df</span> <span class="o">=</span> <span class="n">feature_data</span><span class="p">[</span><span class="n">from_line</span><span class="p">:</span><span class="n">to_line</span><span class="p">]</span>
            <span class="n">predictions_data</span> <span class="o">=</span> <span class="n">PredictionsData</span><span class="p">(</span><span class="n">features_df</span><span class="p">,</span>
                                               <span class="n">predictions</span><span class="p">[</span><span class="n">from_line</span><span class="p">:</span><span class="n">to_line</span><span class="p">],</span>
                                               <span class="n">association_ids</span><span class="o">=</span><span class="n">assoc_id_list_section</span><span class="p">,</span>
                                               <span class="n">class_names</span><span class="o">=</span><span class="n">class_names</span><span class="p">)</span>

            <span class="n">predictions_data_container</span> <span class="o">=</span> <span class="n">PredictionsDataContainer</span><span class="p">(</span>
                <span class="n">GeneralStats</span><span class="p">(</span><span class="n">model_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">),</span> <span class="n">predictions_data</span>
            <span class="p">)</span>
            <span class="n">chunk_payload</span> <span class="o">=</span> <span class="n">predictions_data_container</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">DataFormat</span><span class="o">.</span><span class="n">JSON</span><span class="p">)</span>

            <span class="c1"># Fixing the feature part of the payload to be like what MLOps App expects and not</span>
            <span class="c1"># what the spooler record expects</span>
            <span class="k">if</span> <span class="n">SerializationConstants</span><span class="o">.</span><span class="n">PredictionsDataConstants</span><span class="o">.</span><span class="n">FEATURES_FIELD_NAME</span> <span class="ow">in</span> <span class="n">chunk_payload</span><span class="p">:</span>
                <span class="n">features_dict</span> <span class="o">=</span> <span class="n">chunk_payload</span><span class="p">[</span>
                    <span class="n">SerializationConstants</span><span class="o">.</span><span class="n">PredictionsDataConstants</span><span class="o">.</span><span class="n">FEATURES_FIELD_NAME</span>
                <span class="p">]</span>
                <span class="n">dr_fmt_feature_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features_dict</span><span class="p">:</span>
                    <span class="n">dr_fmt_feature_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">feature</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="n">features_dict</span><span class="p">[</span><span class="n">feature</span><span class="p">]})</span>

                <span class="n">chunk_payload</span><span class="p">[</span><span class="n">SerializationConstants</span><span class="o">.</span><span class="n">PredictionsDataConstants</span><span class="o">.</span><span class="n">FEATURES_FIELD_NAME</span><span class="p">]</span> \
                    <span class="o">=</span> <span class="n">dr_fmt_feature_list</span>
            <span class="n">payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_payload</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">report_prediction_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">deployment_id</span><span class="p">,</span>
            <span class="n">model_id</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">association_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">assoc_id_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">predictions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">class_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Report prediction data for a given model and deployment</span>

<span class="sd">        :param deployment_id: deployment ID to use for reporting.</span>
<span class="sd">        :type deployment_id: str</span>
<span class="sd">        :param model_id: Model ID to report prediction data for</span>
<span class="sd">        :type model_id: str</span>
<span class="sd">        :param data: A DataFrame containing both the feature data and the prediction result</span>
<span class="sd">        :type data: pd.Dataframe</span>
<span class="sd">        :param association_ids: List of association ids if not part of the &#39;data&#39; dataframe</span>
<span class="sd">        :type association_ids: Optional(list(str))</span>
<span class="sd">        :param assoc_id_col: Name of column containing association ids</span>
<span class="sd">        :type assoc_id_col: Optional(str)</span>
<span class="sd">        :param predictions: List of predictions ids if not part of the &#39;data&#39; dataframe</span>
<span class="sd">        :type predictions: Optional(list(?))</span>
<span class="sd">        :param target_col: Name of the target column</span>
<span class="sd">        :type target_col: str</span>
<span class="sd">        :param class_names: List of target class names</span>
<span class="sd">        :type class_names: list</span>
<span class="sd">        :param timestamp: RFC3339 Timestamp of this prediction data</span>
<span class="sd">        :type timestamp: str</span>
<span class="sd">        :returns: Tuple (response from MLOps, size of payload sent)</span>
<span class="sd">        :rtype: Tuple</span>
<span class="sd">        :raises DRConnectedException: if request fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">report_prediction_data</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">})</span>
        <span class="n">input_row_count</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">MMMLimits</span><span class="o">.</span><span class="n">DATA_REPORTING_MAX_CHUNKS</span> <span class="o">*</span> <span class="n">MMMLimits</span><span class="o">.</span><span class="n">DATA_REPORTING_MAX_LINES_PER_CHUNK</span>

        <span class="n">aggregate_payload_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">last_response</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">while</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">input_row_count</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">size</span>
            <span class="k">if</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="n">input_row_count</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">input_row_count</span>
            <span class="n">data_chunk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">payload_report_prediction_data</span><span class="p">(</span>
                <span class="n">model_id</span><span class="p">,</span>
                <span class="n">data_chunk</span><span class="p">,</span>
                <span class="n">association_ids</span><span class="p">,</span>
                <span class="n">assoc_id_col</span><span class="p">,</span>
                <span class="n">predictions</span><span class="p">,</span>
                <span class="n">target_col</span><span class="p">,</span>
                <span class="n">class_names</span><span class="p">,</span>
                <span class="n">timestamp</span>
            <span class="p">)</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
                    <span class="n">payload_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
                    <span class="n">aggregate_payload_size</span> <span class="o">+=</span> <span class="n">payload_size</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">end</span>
                    <span class="n">last_response</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;ok&quot;</span><span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                                                        <span class="n">verify_ssl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">ACCEPTED</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                            <span class="s2">&quot;Failed to post prediction data: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                        <span class="n">json_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                        <span class="n">last_response</span> <span class="o">=</span> <span class="n">json_response</span>
                        <span class="n">payload_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
                        <span class="n">aggregate_payload_size</span> <span class="o">+=</span> <span class="n">payload_size</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="n">end</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                                   <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
                <span class="k">continue</span>

            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                    <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">last_response</span><span class="p">,</span> <span class="n">aggregate_payload_size</span>

    <span class="k">def</span> <span class="nf">_is_model_package_download_from_registry_supported</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_major_version</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_major_version</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_minor_version</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_download_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">retrieve_url_response</span><span class="p">):</span>
        <span class="c1"># Write to local file if provided</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">parse_header</span><span class="p">(</span><span class="n">retrieve_url_response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-Disposition&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">])</span>
        <span class="n">model_package_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">model_package_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">target</span><span class="p">:</span>
            <span class="n">target</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">retrieve_url_response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">model_package_path</span>

    <span class="k">def</span> <span class="nf">download_model_package_from_registry</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">model_package_id</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">600</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download the model package file from model registry</span>

<span class="sd">        :param model_package_id: ID of the model package to download</span>
<span class="sd">        :param output_dir: destination directory where to download model</span>
<span class="sd">        :param timeout: time to wait for result (sec). Default: 120 sec.</span>
<span class="sd">        :return: The path of download model package</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_model_package_download_from_registry_supported</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;Downloading model package from model registry is</span>
<span class="sd">                supported for API version 2.25 and later&quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;provide output_dir &#39;</span><span class="si">{}</span><span class="s2">&#39; does not exists&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_dir</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;provided output_dir &#39;</span><span class="si">{}</span><span class="s2">&#39; is not a directory&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_dir</span><span class="p">))</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">)</span>
        <span class="n">model_build_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">model_package_build_from_registry</span><span class="p">(</span><span class="n">model_package_id</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">model_build_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">ACCEPTED</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Failed to download model package: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="c1"># wait for completion</span>
        <span class="n">model_retrieve_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_async_completion</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_LOCATION_KEY</span><span class="p">],</span> <span class="n">timeout</span>
        <span class="p">)</span>

        <span class="c1"># Download the model package</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">model_retrieve_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Failed to download model package: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_model</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_dr_current_model_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                          <span class="n">deployment_id</span><span class="p">,</span>
                                          <span class="n">output_dir</span><span class="p">,</span>
                                          <span class="n">download_scoring_code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                          <span class="n">scoring_code_binary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                          <span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download current model package file of given deployment</span>

<span class="sd">        :param deployment_id: deployment ID to use for reporting.</span>
<span class="sd">        :param output_dir: destination directory where to download model</span>
<span class="sd">        :param download_scoring_code: Download the scoring code &quot;jar&quot; or &quot;mlpkg&quot; file, default is</span>
<span class="sd">            mlpkg file</span>
<span class="sd">        :param scoring_code_binary: Download scoring code as binary if required</span>
<span class="sd">        :param timeout: time to wait for result (sec). Default: 120 sec.</span>
<span class="sd">        :return: The path of download model package</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;provide output_dir &#39;</span><span class="si">{}</span><span class="s2">&#39; does not exists&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_dir</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;provided output_dir &#39;</span><span class="si">{}</span><span class="s2">&#39; is not a directory&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_dir</span><span class="p">))</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_headers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">download_scoring_code</span> <span class="ow">and</span> <span class="n">scoring_code_binary</span><span class="p">:</span>
            <span class="c1"># Download binary scoring code in single request</span>
            <span class="n">scoring_code_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">scoring_code_download</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">scoring_code_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to download binary scoring code: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Wait for completion needed</span>
            <span class="k">if</span> <span class="n">download_scoring_code</span><span class="p">:</span>
                <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">})</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;includeAgent&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
                <span class="n">model_build_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">scoring_code_build</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="n">model_build_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">model_build_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">model_package_build</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">model_build_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">ACCEPTED</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to download model package: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

            <span class="c1"># wait for completion</span>
            <span class="n">model_retrieve_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_async_completion</span><span class="p">(</span>
                <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">MLOpsClient</span><span class="o">.</span><span class="n">RESPONSE_LOCATION_KEY</span><span class="p">],</span> <span class="n">timeout</span><span class="p">)</span>

            <span class="c1"># Download the model package</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_retrieve_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to download model package: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_model</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_service_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get information about a deployment&#39;s service stats from DataRobot MLOps.</span>

<span class="sd">        :param deployment_id: ID of the deployment</span>
<span class="sd">        :type deployment_id: str</span>
<span class="sd">        :returns: JSON containing the service stats</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if model package retrieval failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">get_service_stats</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_url_request_response</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="n">json_response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">json_response</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_prediction_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment_id</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get information about a deployment&#39;s prediction stats from DataRobot MLOps.</span>

<span class="sd">        :param deployment_id: ID of the deployment</span>
<span class="sd">        :type deployment_id: str</span>
<span class="sd">        :returns: JSON containing the prediction stats</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises DRConnectedException: if model package retrieval failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># We need to provide the end time for the predictions window.</span>
        <span class="c1"># We adjust our window to make sure end is in the future, regardless of timezone.</span>
        <span class="c1"># Note: timestamp must obey RFC 3339, so Python&#39;s isoformat() is convenient but wrong.</span>
        <span class="n">day_after_tomorrow</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">day_after_tomorrow</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">end_time</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">model_id</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;modelId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_id</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_builder</span><span class="o">.</span><span class="n">get_prediction_stats</span><span class="p">(</span><span class="n">deployment_id</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_url_request_response</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="n">json_response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">json_response</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span><span class="s2">&quot;Call </span><span class="si">{}</span><span class="s2"> failed: text:[</span><span class="si">{}</span><span class="s2">]&quot;</span>
                                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DRConnectedException</span><span class="p">(</span>
                <span class="s2">&quot;Connection to DataRobot MLOps [</span><span class="si">{}</span><span class="s2">] refused; </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright © DataRobot, Inc. 2019. All Rights Reserved..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>